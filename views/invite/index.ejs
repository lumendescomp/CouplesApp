<div class="max-w-xl mx-auto space-y-6">
  <div>
    <h1 class="text-2xl font-semibold text-violet-200 mb-1">
      Convidar parceiro(a)
    </h1>
    <p class="text-sm text-violet-200/80 mb-3">
      Compartilhe um código de amor válido por 24 horas.
    </p>

    <!-- Mensagem de erro -->
    <div id="invite-error" class="mb-3"></div>

    <button
      class="btn-heart px-4 py-2 rounded-full"
      hx-post="/invite/create"
      hx-target="#invites-list"
      hx-swap="afterbegin"
    >
      Gerar novo código
    </button>
    <p class="text-xs text-violet-200/70 mt-2">
      Códigos expiram em 24h e são de uso único.
    </p>
  </div>

  <div>
    <h2 class="font-semibold text-violet-200 mb-2">Seus convites ativos</h2>
    <div id="invites-list" class="space-y-2">
      <% if (invites.length === 0) { %>
      <div class="text-violet-200/80">
        Nenhum convite ativo. Gere um novo código.
      </div>
      <% } %> <% invites.forEach(invite => { %> <%- include('_code_row', {
      invite }) %> <% }) %>
    </div>
  </div>
</div>

<script>
  // Tratar erros do HTMX
  document.body.addEventListener("htmx:responseError", function (evt) {
    if (
      evt.detail.xhr.status === 400 &&
      evt.detail.pathInfo.requestPath === "/invite/create"
    ) {
      const errorDiv = document.getElementById("invite-error");
      errorDiv.innerHTML = evt.detail.xhr.response;

      // Esconde após 7 segundos
      setTimeout(() => {
        errorDiv.innerHTML = "";
      }, 7000);
    }
  });

  // Limpa erro quando houver sucesso
  document.body.addEventListener("htmx:afterSwap", function (evt) {
    if (evt.detail.target.id === "invites-list") {
      document.getElementById("invite-error").innerHTML = "";
    }
  });
</script>
