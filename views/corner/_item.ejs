<div
  class="corner-item group absolute select-none"
  data-id="<%= item.id %>"
  data-key="<%= item.item_key %>"
  data-x="<%= item.x %>"
  data-y="<%= item.y %>"
  data-z="<%= item.z || 0 %>"
  data-rot="<%= item.rotation %>"
  data-tilt-x="<%= (item.tilt_x == null ? 0 : item.tilt_x) %>"
  data-tilt-y="<%= (item.tilt_y == null ? 0 : item.tilt_y) %>"
  data-flip-x="<%= (item.flip_x ? 1 : 0) %>"
  data-flip-y="<%= (item.flip_y ? 1 : 0) %>"
  data-scale="<%= (item.scale == null ? 1.0 : item.scale) %>"
  data-layer="<%= (item.layer == null ? 0 : item.layer) %>"
  data-color="<%= (item.color == null ? '' : item.color) %>"
>
  <!-- token csrf para incluir nos nudges via hx-include -->
  <input
    type="hidden"
    id="csrf-<%= item.id %>"
    name="_csrf"
    value="<%= csrfToken %>"
  />
  <div
    class="w-16 h-16 md:w-20 md:h-20 rounded-xl border border-violet-700/40 bg-white/10 text-violet-100 flex items-center justify-center shadow relative"
  >
    <!-- sombra do item (forma elíptica isométrica) -->
    <span
      class="pointer-events-none absolute left-1/2 top-[95%] -translate-x-1/2 -translate-y-1/2 block w-12 h-3 md:w-14 md:h-3.5 rounded-full"
      style="
        background: radial-gradient(
          ellipse at center,
          rgba(0, 0, 0, 0.22),
          rgba(0, 0, 0, 0.06) 60%,
          transparent 70%
        );
      "
    ></span>
    <% if (item.item_key === 'table') { %>
    <!-- Mesa -->
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="1.8"
      class="w-10 h-10"
    >
      <circle cx="12" cy="9" r="5" />
      <path
        d="M7 9v9M17 9v9M7 18h10"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
    </svg>
    <span class="sr-only">Mesa</span>
    <% } else if (item.item_key === 'chair') { %>
    <!-- Cadeira -->
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="1.8"
      class="w-10 h-10"
    >
      <rect x="8" y="5" width="8" height="6" rx="1" />
      <rect x="7" y="12" width="10" height="3" rx="1" />
      <path
        d="M8 15v4M16 15v4M7 19h10"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
    </svg>
    <span class="sr-only">Cadeira</span>
    <% } else if (item.item_key === 'plant') { %>
    <!-- Planta -->
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="1.8"
      class="w-10 h-10"
    >
      <path
        d="M12 12c0-3 2.5-5 5-5 0 2.5-2 5-5 5Zm0 0c0-3-2.5-5-5-5 0 2.5 2 5 5 5Z"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
      <path d="M12 12v3" stroke-linecap="round" />
      <path d="M7 18h10l-1.2 2H8.2L7 18Z" stroke-linejoin="round" />
      <path d="M9 18l-.8-2h7.6L15 18" stroke-linejoin="round" />
    </svg>
    <span class="sr-only">Planta</span>
    <% } else if (item.item_key === 'lamp') { %>
    <!-- Luminária -->
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="1.8"
      class="w-10 h-10"
    >
      <path d="M7 9h10l-2-5H9l-2 5Z" stroke-linejoin="round" />
      <path d="M12 9v7" stroke-linecap="round" />
      <path d="M8 20h8" stroke-linecap="round" />
    </svg>
    <span class="sr-only">Luminária</span>
    <% } else { %>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="1.8"
      class="w-10 h-10"
    >
      <circle cx="12" cy="12" r="5" />
    </svg>
    <span class="sr-only"><%= item.item_key %></span>
    <% } %>
  </div>
  <!-- Controles de mover/girar (aparecem no hover) -->
  <div
    class="absolute -bottom-2 right-0 opacity-0 group-hover:opacity-100 transition pointer-events-auto"
  >
    <div
      class="flex gap-1 bg-black/30 backdrop-blur-sm p-1 rounded-lg border border-violet-700/40"
    >
      <!-- mover -->
      <button
        class="w-7 h-7 rounded bg-white/10 hover:bg-white/20 text-violet-100"
        title="Esquerda"
        hx-post="/corner/items/<%= item.id %>/nudge"
        hx-include="#csrf-<%= item.id %>"
        hx-target="closest div.group"
        hx-swap="outerHTML"
        hx-vals='{"dx": -2}'
      >
        ◀
      </button>
      <div class="flex flex-col gap-1">
        <button
          class="w-7 h-7 rounded bg-white/10 hover:bg-white/20 text-violet-100"
          title="Cima"
          hx-post="/corner/items/<%= item.id %>/nudge"
          hx-include="#csrf-<%= item.id %>"
          hx-target="closest div.group"
          hx-swap="outerHTML"
          hx-vals='{"dy": -2}'
        >
          ▲
        </button>
        <button
          class="w-7 h-7 rounded bg-white/10 hover:bg-white/20 text-violet-100"
          title="Baixo"
          hx-post="/corner/items/<%= item.id %>/nudge"
          hx-include="#csrf-<%= item.id %>"
          hx-target="closest div.group"
          hx-swap="outerHTML"
          hx-vals='{"dy": 2}'
        >
          ▼
        </button>
      </div>
      <button
        class="w-7 h-7 rounded bg-white/10 hover:bg-white/20 text-violet-100"
        title="Direita"
        hx-post="/corner/items/<%= item.id %>/nudge"
        hx-include="#csrf-<%= item.id %>"
        hx-target="closest div.group"
        hx-swap="outerHTML"
        hx-vals='{"dx": 2}'
      >
        ▶
      </button>
      <!-- girar -->
      <button
        class="w-7 h-7 rounded bg-white/10 hover:bg-white/20 text-violet-100"
        title="Girar -15°"
        hx-post="/corner/items/<%= item.id %>/nudge"
        hx-include="#csrf-<%= item.id %>"
        hx-target="closest div.group"
        hx-swap="outerHTML"
        hx-vals='{"drot": -15}'
      >
        ↺
      </button>
      <button
        class="w-7 h-7 rounded bg-white/10 hover:bg-white/20 text-violet-100"
        title="Girar +15°"
        hx-post="/corner/items/<%= item.id %>/nudge"
        hx-include="#csrf-<%= item.id %>"
        hx-target="closest div.group"
        hx-swap="outerHTML"
        hx-vals='{"drot": 15}'
      >
        ↻
      </button>
      <!-- altura -->
      <button
        class="w-7 h-7 rounded bg-white/10 hover:bg-white/20 text-violet-100"
        title="Subir"
        hx-post="/corner/items/<%= item.id %>/height"
        hx-include="#csrf-<%= item.id %>"
        hx-target="closest div.group"
        hx-swap="outerHTML"
        hx-vals='{"dz": 1}'
      >
        ⤴
      </button>
      <button
        class="w-7 h-7 rounded bg-white/10 hover:bg-white/20 text-violet-100"
        title="Descer"
        hx-post="/corner/items/<%= item.id %>/height"
        hx-include="#csrf-<%= item.id %>"
        hx-target="closest div.group"
        hx-swap="outerHTML"
        hx-vals='{"dz": -1}'
      >
        ⤵
      </button>
    </div>
  </div>
  <form
    class="absolute -top-2 -right-2"
    hx-post="/corner/items/<%= item.id %>/delete"
    hx-swap="outerHTML"
    hx-target="closest div.group"
  >
    <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
    <button
      class="w-6 h-6 rounded-full bg-rose-600/80 hover:bg-rose-600 text-white text-xs leading-6"
      title="Remover"
    >
      ×
    </button>
  </form>
</div>
